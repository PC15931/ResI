<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Risikoanalyse - Umfassende Analyse agrarrelevanter Risiken">
  <title>Risikoanalyse â€“ ResI</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Skip Navigation -->
  <a href="#main" class="skip-link">Zum Inhalt springen</a>

  <!-- Hauptnavigation -->
  <header class="page-header">
    <div class="logo">ResI</div>
    <nav id="nav" aria-label="Hauptnavigation">
      <ul class="nav-left">
        <li><a href="dashboard.html">ğŸ  Home</a></li>
      </ul>
      <ul class="nav-right">
        <li><a href="daten.html">ğŸ“¤ Datenmanagement</a></li>
        <li><a href="risikoanalyse.html" aria-current="page">ğŸ“Š Analysen</a></li>
        <li><a href="benutzer.html">ğŸ‘¤ Benutzerbereich</a></li>
        <li><a href="info.html">â„¹ï¸ Info & Support</a></li>
      </ul>
    </nav>
    <button class="mobile-menu" aria-controls="nav" aria-expanded="false" onclick="toggleMenu()">â˜°</button>
  </header>

  <!-- Sub-Navigation fÃ¼r Analysen -->
  <nav class="sub-nav" aria-label="UntermenÃ¼ Analysen">
    <ul>
      <li><a href="risikoanalyse.html" aria-current="page">âš ï¸ Risikoanalyse</a></li>
      <li><a href="report.html">ğŸ“‘ Reports</a></li>
      <li><a href="weather.html">ğŸŒ Wetterdaten</a></li>
    </ul>
  </nav>

  <!-- Inhalt -->
  <main id="main" class="page-content">
    <section class="content-box">
      <div class="page-title-section">
        <h1>Risikoanalyse</h1>
        <p class="lead">Umfassende Analyse und Bewertung agrarrelevanter Risikofaktoren basierend auf KI-Modellen</p>
      </div>

      <!-- Risiko-Score -->
      <div class="risk-score-container">
        <div class="score-card main-score">
          <div class="score-header">
            <h2>Gesamtrisiko-Score</h2>
            <button class="btn btn-secondary btn-sm" onclick="refreshData()">ğŸ”„ Aktualisieren</button>
          </div>
          <div class="score-value" id="totalScore">0</div>
          <div class="score-label">von 100 Punkten</div>
          <div class="score-trend">
            <span class="trend-indicator positive">â†“ -3.2%</span>
            <span class="trend-label">vs. letzter Monat</span>
          </div>
        </div>

        <div class="score-breakdown">
          <div class="breakdown-item risk-low">
            <div class="breakdown-icon">âœ…</div>
            <div class="breakdown-content">
              <div class="breakdown-label">Niedriges Risiko</div>
              <div class="breakdown-value">5 Faktoren</div>
            </div>
          </div>
          <div class="breakdown-item risk-medium">
            <div class="breakdown-icon">âš ï¸</div>
            <div class="breakdown-content">
              <div class="breakdown-label">Mittleres Risiko</div>
              <div class="breakdown-value">3 Faktoren</div>
            </div>
          </div>
          <div class="breakdown-item risk-high">
            <div class="breakdown-icon">ğŸ”´</div>
            <div class="breakdown-content">
              <div class="breakdown-label">Hohes Risiko</div>
              <div class="breakdown-value">1 Faktor</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Liniendiagramm - Risikoentwicklung -->
      <div class="chart">
        <div class="chart-header">
          <h2>Risikoentwicklung Ã¼ber 12 Monate</h2>
          <div class="chart-controls">
            <select id="timeRange" onchange="updateLineChart()">
              <option value="12">12 Monate</option>
              <option value="6">6 Monate</option>
              <option value="3">3 Monate</option>
            </select>
          </div>
        </div>
        <canvas id="lineChart" aria-label="Liniendiagramm der Risikoentwicklung"></canvas>
        <div class="chart-legend">
          <span class="legend-item">
            <span class="legend-color" style="background: #2e7d32;"></span>
            Risiko-Wert
          </span>
          <span class="legend-item">
            <span class="legend-color" style="background: #ff9800;"></span>
            Schwellenwert
          </span>
        </div>
      </div>

      <!-- Balkendiagramm - Risikofaktoren -->
      <div class="chart">
        <div class="chart-header">
          <h2>Risikofaktoren nach Kategorie</h2>
          <div class="chart-controls">
            <button class="btn btn-secondary btn-sm" onclick="exportChart('barChart')">ğŸ“¥ Export</button>
          </div>
        </div>
        <canvas id="barChart" aria-label="Balkendiagramm der Risikofaktoren"></canvas>
        <div class="risk-details">
          <div class="risk-detail-card">
            <h3>ğŸŒ¤ï¸ Wetter</h3>
            <div class="risk-meter">
              <div class="risk-meter-fill" style="width: 65%; background: #66bb6a;"></div>
            </div>
            <p class="risk-value">65/100 - Moderates Risiko</p>
            <p class="risk-description">Niederschlag im Normalbereich, Temperaturen stabil</p>
          </div>
          <div class="risk-detail-card">
            <h3>ğŸŒ± Boden</h3>
            <div class="risk-meter">
              <div class="risk-meter-fill" style="width: 42%; background: #43a047;"></div>
            </div>
            <p class="risk-value">42/100 - Geringes Risiko</p>
            <p class="risk-description">Bodenwerte im optimalen Bereich</p>
          </div>
          <div class="risk-detail-card">
            <h3>ğŸ’° Markt</h3>
            <div class="risk-meter">
              <div class="risk-meter-fill" style="width: 78%; background: #ff9800;"></div>
            </div>
            <p class="risk-value">78/100 - ErhÃ¶htes Risiko</p>
            <p class="risk-description">Preisschwankungen beobachtet</p>
          </div>
        </div>
      </div>

      <!-- Radar Chart - Multidimensionale Analyse -->
      <div class="chart">
        <h2>Multidimensionale Risikobewertung</h2>
        <canvas id="radarChart" aria-label="Radar-Diagramm der Risikobewertung"></canvas>
        <p class="chart-description">
          Diese Darstellung zeigt die Verteilung der Risikofaktoren Ã¼ber verschiedene Dimensionen hinweg.
        </p>
      </div>

      <!-- Aktuelle Warnungen -->
      <div class="chart">
        <h2>Aktuelle Warnungen & Empfehlungen</h2>
        <div class="warning-list">
          <div class="warning-card warning-high">
            <div class="warning-header">
              <span class="warning-icon">ğŸ”´</span>
              <div class="warning-title">
                <h3>Kritische Bodenwerte in Feld A</h3>
                <span class="warning-time">vor 2 Stunden</span>
              </div>
            </div>
            <p class="warning-description">
              Die pH-Werte haben den kritischen Schwellenwert Ã¼berschritten. Sofortige ÃœberprÃ¼fung empfohlen.
            </p>
            <div class="warning-actions">
              <button class="btn btn-primary btn-sm">Details anzeigen</button>
              <button class="btn btn-secondary btn-sm">Als gelesen markieren</button>
            </div>
          </div>

          <div class="warning-card warning-medium">
            <div class="warning-header">
              <span class="warning-icon">âš ï¸</span>
              <div class="warning-title">
                <h3>Wetterprognose: Starkregen erwartet</h3>
                <span class="warning-time">vor 5 Stunden</span>
              </div>
            </div>
            <p class="warning-description">
              FÃ¼r die nÃ¤chsten 48 Stunden wird starker Niederschlag vorhergesagt. BewÃ¤sserung anpassen.
            </p>
            <div class="warning-actions">
              <button class="btn btn-primary btn-sm">Details anzeigen</button>
              <button class="btn btn-secondary btn-sm">Als gelesen markieren</button>
            </div>
          </div>

          <div class="warning-card warning-low">
            <div class="warning-header">
              <span class="warning-icon">â„¹ï¸</span>
              <div class="warning-title">
                <h3>Optimaler Zeitpunkt fÃ¼r DÃ¼ngung</h3>
                <span class="warning-time">vor 1 Tag</span>
              </div>
            </div>
            <p class="warning-description">
              Basierend auf Wetterprognose und Bodenwerten ist jetzt ein gÃ¼nstiger Zeitpunkt fÃ¼r die DÃ¼ngung.
            </p>
            <div class="warning-actions">
              <button class="btn btn-primary btn-sm">Details anzeigen</button>
              <button class="btn btn-secondary btn-sm">Als gelesen markieren</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="chart">
        <h2>Schnellaktionen</h2>
        <div class="quick-actions">
          <button class="btn btn-primary" onclick="window.location.href='report.html'">
            ğŸ“‘ Detaillierten Report erstellen
          </button>
          <button class="btn btn-secondary" onclick="window.location.href='daten_export.html'">
            â¬‡ï¸ Analysedaten exportieren
          </button>
          <button class="btn btn-secondary" onclick="scheduleAnalysis()">
            ğŸ• Analyse planen
          </button>
        </div>
      </div>
    </section>
  </main>

  <script>
    function toggleMenu() {
      const nav = document.getElementById('nav');
      const trigger = document.querySelector('.mobile-menu');
      const isOpen = nav.classList.toggle('open');
      trigger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    }

    // ZufÃ¤llige Werte fÃ¼r 12 Monate
    const months = ["Jan", "Feb", "MÃ¤r", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"];
    let riskValues = months.map(() => Math.floor(Math.random() * 100));

    // Durchschnitt berechnen und anzeigen
    function updateTotalScore() {
      const avgScore = (riskValues.reduce((a, b) => a + b, 0) / riskValues.length).toFixed(0);
      const scoreElement = document.getElementById("totalScore");
      
      let currentScore = 0;
      const targetScore = parseInt(avgScore);
      const increment = targetScore / 50;
      
      const interval = setInterval(() => {
        currentScore += increment;
        if (currentScore >= targetScore) {
          currentScore = targetScore;
          clearInterval(interval);
        }
        scoreElement.textContent = Math.floor(currentScore);
      }, 20);
    }

    // Liniendiagramm
    let lineChart;
    function createLineChart() {
      const ctx = document.getElementById("lineChart");
      lineChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: months,
          datasets: [
            {
              label: "Risiko-Wert",
              data: riskValues,
              borderColor: "#2e7d32",
              backgroundColor: "rgba(46,125,50,0.1)",
              fill: true,
              tension: 0.4,
              pointRadius: 5,
              pointHoverRadius: 7,
              pointBackgroundColor: "#2e7d32",
              pointBorderColor: "#fff",
              pointBorderWidth: 2
            },
            {
              label: "Schwellenwert",
              data: Array(12).fill(70),
              borderColor: "#ff9800",
              backgroundColor: "transparent",
              borderDash: [5, 5],
              pointRadius: 0,
              tension: 0
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: "rgba(0,0,0,0.8)",
              padding: 12,
              titleFont: { size: 14 },
              bodyFont: { size: 13 }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                callback: function(value) {
                  return value + ' Pkt';
                }
              },
              grid: {
                color: "rgba(0,0,0,0.05)"
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }

    // Balkendiagramm
    let barChart;
    function createBarChart() {
      const categories = ["Wetter", "Boden", "Markt"];
      const categoryValues = [65, 42, 78];
      const colors = ["#66bb6a", "#43a047", "#ff9800"];

      const ctx = document.getElementById("barChart");
      barChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: categories,
          datasets: [{
            label: "Risiko-Wert",
            data: categoryValues,
            backgroundColor: colors,
            borderRadius: 8,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                callback: function(value) {
                  return value + ' Pkt';
                }
              },
              grid: {
                color: "rgba(0,0,0,0.05)"
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }

    // Radar Chart
    let radarChart;
    function createRadarChart() {
      const ctx = document.getElementById("radarChart");
      radarChart = new Chart(ctx, {
        type: "radar",
        data: {
          labels: ["Wetter", "Boden", "Wasser", "Markt", "SchÃ¤dlinge", "Maschinen"],
          datasets: [{
            label: "Aktuell",
            data: [65, 42, 58, 78, 33, 45],
            borderColor: "#2e7d32",
            backgroundColor: "rgba(46,125,50,0.2)",
            pointBackgroundColor: "#2e7d32",
            pointBorderColor: "#fff",
            pointHoverBackgroundColor: "#fff",
            pointHoverBorderColor: "#2e7d32"
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            r: {
              beginAtZero: true,
              max: 100,
              ticks: {
                stepSize: 20
              },
              grid: {
                color: "rgba(0,0,0,0.1)"
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }

    function updateLineChart() {
      const range = document.getElementById('timeRange').value;
      // Hier wÃ¼rde die Logik zum Aktualisieren des Charts kommen
      console.log('Update chart for range:', range);
    }

    function exportChart(chartId) {
      alert('Chart-Export wird vorbereitet (Simulation)');
    }

    function refreshData() {
      alert('Daten werden aktualisiert...');
      location.reload();
    }

    function scheduleAnalysis() {
      alert('Analyse-Planung Ã¶ffnen (Simulation)');
    }

    // Initialize on load
    window.addEventListener('load', () => {
      updateTotalScore();
      createLineChart();
      createBarChart();
      createRadarChart();
    });
  </script>
</body>
</html>